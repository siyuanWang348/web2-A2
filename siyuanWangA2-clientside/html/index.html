<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Charity Events - Home</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="logo">Charity Events</div>
    <div class="nav-links">
      <a href="/" class="active">Home</a>
      <a href="/search">Search Events</a>
    </div>
  </nav>

  <div class="container">
    <!-- æ…ˆå–„ç»„ç»‡åŸºæœ¬ä¿¡æ¯ -->
    <section class="organization-info">
      <h1>ğŸŒŸ Welcome to Charity Events</h1>
      <p>We connect you with meaningful charity events in your city. Join us to support education, healthcare, and the environment.</p>
      
      <h2>Our Mission</h2>
      <p>Our mission is to create a world where everyone can easily participate in charitable activities, fostering community spirit and driving positive social change through collective action.</p>
      
      <h2>Contact Us</h2>
      <p>ğŸ“§ Email: sherryWang@163.com </p>
      <p>ğŸ“ Phone: 13113560313ï¼ˆSherry's mobile phone numberï¼‰</p>
      <p>ğŸ¢ Address: Wenchang Campus of Guangxi University of Science and Technology</p>
    </section>

    <!-- å³å°†åˆ°æ¥çš„æ´»åŠ¨åˆ—è¡¨ -->
    <section class="events-section upcoming-events">
      <h2>Upcoming Events</h2>
      <div id="upcoming-events" class="events-grid"></div>
    </section>

    <!-- è¿‡å»çš„æ´»åŠ¨åˆ—è¡¨ -->
    <section class="events-section past-events">
      <h2>Past Charity Events</h2>
      <div id="past-events" class="events-grid"></div>
    </section>
  </div>

  <script>
    // è·å–å½“å‰æ—¥æœŸï¼ˆä¸åŒ…å«æ—¶é—´éƒ¨åˆ†ï¼Œç”¨äºæ¯”è¾ƒï¼‰
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    fetch('http://localhost:3001/api/events')
      .then(res => res.json())
      .then(events => {
        const upcomingContainer = document.getElementById('upcoming-events');
        const pastContainer = document.getElementById('past-events');
        
        // è¿‡æ»¤æ‰è¿åæ”¿ç­–çš„æ´»åŠ¨
        const validEvents = events.filter(ev => !ev.is_violating_policy);
        
        // åˆ†ç¦»å³å°†åˆ°æ¥å’Œè¿‡å»çš„æ´»åŠ¨
        const upcomingEvents = [];
        const pastEvents = [];
        
        validEvents.forEach(ev => {
          // è§£ææ´»åŠ¨æ—¥æœŸï¼ˆä¸åŒ…å«æ—¶é—´éƒ¨åˆ†ï¼‰
          const eventDate = new Date(ev.event_date);
          eventDate.setHours(0, 0, 0, 0);
          
          // æ ¹æ®æ—¥æœŸå°†æ´»åŠ¨åˆ†ç±»
          if (eventDate < today) {
            pastEvents.push(ev);
          } else {
            upcomingEvents.push(ev);
          }
        });

        // æ˜¾ç¤ºå³å°†åˆ°æ¥çš„æ´»åŠ¨
        if (upcomingEvents.length === 0) {
          upcomingContainer.innerHTML = "<p>No upcoming events available at this time.</p>";
        } else {
          upcomingEvents.forEach(ev => {
            upcomingContainer.appendChild(createEventCard(ev, 'upcoming', 'Upcoming'));
          });
        }

        // æ˜¾ç¤ºè¿‡å»çš„æ´»åŠ¨
        if (pastEvents.length === 0) {
          pastContainer.innerHTML = "<p>No past events recorded.</p>";
        } else {
          pastEvents.forEach(ev => {
            pastContainer.appendChild(createEventCard(ev, 'past', 'Past'));
          });
        }
      })
      .catch(err => {
        console.error("Error loading events:", err);
        document.getElementById('upcoming-events').innerHTML = "<p>Error loading events. Please try again later.</p>";
        document.getElementById('past-events').innerHTML = "<p>Error loading events. Please try again later.</p>";
      });

    // åˆ›å»ºæ´»åŠ¨å¡ç‰‡çš„è¾…åŠ©å‡½æ•°
    function createEventCard(event, status, statusText) {
      const div = document.createElement('div');
      div.className = `event-card ${status}`;
      div.innerHTML = `
        ${event.image_url ? `<img src="${event.image_url}" alt="${event.title}" class="event-image">` : ''}
        <div class="event-status ${status}">${statusText}</div>
        <h3>${event.title}</h3>
        <p>ğŸ“… ${new Date(event.event_date).toLocaleString()}</p>
        <p>ğŸ“ ${event.location}</p>
        <p>ğŸ·ï¸ ${event.category_name || 'Uncategorized'} | Organized by ${event.org_name || 'Unknown Organization'}</p>
        <a href="/event?event_id=${event.event_id}" class="btn">ğŸ” View Details</a>
      `;
      return div;
    }
    </script>
</body> 
</html>
