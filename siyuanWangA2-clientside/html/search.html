<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Search Charity Events</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    /* è‡ªå®šä¹‰æ—¥å†å¼¹çª—æ ·å¼ */
    input[type="date"] {
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      background-color: #fff;
      cursor: pointer;
      font-family: inherit;
    }

    /* è°ƒæ•´æ—¥å†å†…éƒ¨å…ƒç´ æ ·å¼ï¼Œä½¿å…¶æ›´ç¬¦åˆé¡µé¢è®¾è®¡ */
    input[type="date"]::-webkit-calendar-picker-indicator {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
      padding: 2px;
    }

    input[type="date"]::-webkit-datetime-edit-text {
      padding: 0 4px;
    }

    input[type="date"]::-webkit-datetime-edit-month-field,
    input[type="date"]::-webkit-datetime-edit-day-field,
    input[type="date"]::-webkit-datetime-edit-year-field {
      font-weight: 500;
      color: #333;
    }

    /* ç»Ÿä¸€ç»“æœä¸­æ—¥æœŸæ˜¾ç¤ºæ ·å¼ */
    .event-date {
      color: #555;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo">Charity Events</div>
    <div class="nav-links">
      <a href="/">Home</a>
      <a href="/search" class="active">Search Events</a>
    </div>
  </nav>

  <div class="container">
    <h1>ğŸ” Search Events</h1>

    <form id="searchForm" class="search-form">
      <div class="form-group">
        <!-- æ·»åŠ langå±æ€§ç¡®ä¿æ—¥å†å¼¹çª—ä¸ºè‹±æ–‡ -->
        <label>Date: <input type="date" id="date" lang="en"></label>
      </div>
      <div class="form-group">
        <label>Location: <input type="text" id="location" placeholder="Enter location"></label>
      </div>
      <div class="form-group">
        <label>Category: 
          <select id="category">
            <option value="">-- All --</option>
          </select>
        </label>
      </div>
      <div class="form-buttons">
        <button type="submit" class="btn btn-search">Search</button>
        <button type="button" class="btn btn-clear" onclick="clearFilters()">Clear</button>
      </div>
    </form>

    <h2>Results</h2>
    <div id="results" class="events-grid"></div>
  </div>

  <script>
    // åŠ è½½ç±»åˆ«åˆ—è¡¨
    fetch('http://localhost:3001/api/categories')
      .then(res => res.json())
      .then(data => {
        const select = document.getElementById('category');
        data.forEach(cat => {
          const option = document.createElement('option');
          option.value = cat.category_id;
          option.textContent = cat.category_name;
          select.appendChild(option);
        });
      });

    // æœç´¢è¡¨å•æäº¤
    document.getElementById('searchForm').addEventListener('submit', e => {
      e.preventDefault();
      const date = document.getElementById('date').value;
      const location = document.getElementById('location').value;
      const category = document.getElementById('category').value;

      let url = 'http://localhost:3001/api/search?';
      const params = [];
      if (date) params.push(`date=${date}`);
      if (location) params.push(`location=${encodeURIComponent(location)}`);
      if (category) params.push(`category_id=${category}`);
      
      url += params.join('&');

      fetch(url)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById('results');
          container.innerHTML = "";
          if (data.length === 0) {
            container.innerHTML = "<p>No events found.</p>";
            return;
          }
          data.forEach(ev => {
            const div = document.createElement('div');
            div.className = "event-card";
            
            // æ ¼å¼åŒ–æ—¥æœŸä¸ºè‹±æ–‡æ ¼å¼ (MM/DD/YYYY, hh:mm AM/PM)
            const eventDate = new Date(ev.event_date);
            const dateOptions = {
              month: '2-digit',
              day: '2-digit',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit',
              hour12: true,
              timeZone: 'UTC' // ç¡®ä¿æ—¶åŒºä¸€è‡´æ€§
            };
            const formattedDate = eventDate.toLocaleString('en-US', dateOptions);
            
            div.innerHTML = `
              <h3><a href="/event?event_id=${ev.event_id}">${ev.title}</a></h3>
              <p class="event-date">ğŸ“… ${formattedDate}</p>
              <p>ğŸ“ ${ev.location}</p>
              <p>ğŸ·ï¸ ${ev.category_name} | Org: ${ev.org_name}</p>
              <button class="btn" onclick="window.location.href='/event?event_id=${ev.event_id}'">View Details</button>
            `;
            container.appendChild(div);
          });
        });
    });

    function clearFilters() {
      document.getElementById('date').value = "";
      document.getElementById('location').value = "";
      document.getElementById('category').value = "";
      document.getElementById('results').innerHTML = "";
    }
  </script>
</body>
</html>